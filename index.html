<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>mi-juカウンセリングシート</title>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <style>
    /* 既存デザイン踏襲 */
    .side-nav{position:fixed;right:-5px;top:80%;transform:translateY(-50%) translateX(15px);background:#13ca5e;display:flex;flex-direction:column;align-items:center;padding:4px;border-radius:10px 0 0 10px;z-index:1000;width:35px}
    .side-nav a{display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff;text-decoration:none;font-size:10px;margin:5px 0;padding:5px;border-radius:5px;width:30px;height:30px;text-align:center}
    .side-nav a span{font-size:24px;position:absolute;left:0;top:13px}
    @media(max-width:600px){.side-nav{right:2px;width:30px}.side-nav a{width:28px;height:28px}.side-nav a i{font-size:12px}}
    body{font-family:Arial,sans-serif;background:#f7f7f7;display:flex;justify-content:center;align-items:flex-start;height:100vh;margin:0;padding-top:20px}
    .container{background:#fff;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,.1);width:90%;max-width:500px;padding:20px;box-sizing:border-box}
    h1{background:linear-gradient(135deg,#13ca5e,#0fa958);color:#fff;padding:20px;border-radius:0 15px 0 45px;text-align:center;display:block;margin:-20px -15px 20px -15px;font-size:26px;font-weight:600;box-shadow:inset 0 -5px 10px rgba(0,0,0,.05)}
    .label{display:block;margin-bottom:10px;padding:3px;font-weight:600;background:#13ca5e;color:#fff;border-radius:6px;font-size:18px;text-align:center}
    input[type="text"], input[type="tel"], textarea{width:100%;padding:12px;margin-bottom:16px;border:1px solid #ccc;border-radius:6px;box-sizing:border-box;font-size:16px;transition:.3s}
    input:focus, textarea:focus{border-color:#13ca5e;outline:none;box-shadow:0 0 8px rgba(0,123,255,.2)}
    .group{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:16px}
    .group button{flex:1;padding:10px;border:1px solid #ccc;border-radius:6px;background:#f7f7f7;cursor:pointer;white-space:nowrap}
    .group button.active{background:#444;color:#fff}
    .required{color:#fff;font-size:.6em;margin-left:5px;background:#ff0f0f;padding:0 5px;border-radius:3px}
    .submit-button{width:100%;padding:15px;border:none;border-radius:6px;background:#dc3545;color:#fff;font-size:18px;cursor:pointer}
    .info-text{margin:12px 0;background:#f8f9fa;border:1px solid #ced4da;border-radius:8px;padding:12px;font-size:13px}
    .hidden{display:none}
  </style>
</head>
<body>
  <!-- 右側の追従ナビ -->
  <div class="side-nav" id="sideNav">
    <a href="#section-message">
      <span>⇩</span>
      <i class="fas fa-comment"></i>
    </a>
  </div>

  <!-- 本文 -->
  <div class="container">
    <h1>mi-ju<br>カウンセリングシート</h1>
    <div class="info-text">以下全て入力後【送信】ボタンを押してください（※は必須）。</div>

    <!-- ① お名前（必須） -->
    <div class="label"><span class="required">必須</span>① お名前</div>
    <textarea id="name" rows="1" placeholder="例）山田 花子"></textarea>

    <!-- ② お電話番号（必須） -->
    <div class="label"><span class="required">必須</span>② お電話番号</div>
    <textarea id="tel" rows="1" placeholder="例）090-1234-5678"></textarea>

    <!-- ③ 生年月日（任意） -->
    <div class="label">③ 生年月日（任意）</div>
    <input type="text" id="birthday" placeholder="例）1998/03/15">

    <!-- ④ お住まい（必須：回答例文を表示） -->
    <div class="label"><span class="required">必須</span>④ お住まい</div>
    <input type="text" id="address" placeholder="例）京都市中京区（最寄り：烏丸駅）">

    <!-- ⑤ アレルギー（必須） -->
    <div class="label"><span class="required">必須</span>⑤ アレルギーはありますか？</div>
    <div class="group" data-key="allergy">
      <button type="button" data-value="ある" onclick="selectSingle('allergy', this)">ある</button>
      <button type="button" data-value="なし" onclick="selectSingle('allergy', this)">なし</button>
    </div>
    <div id="allergyDetailWrap" class="hidden">
      <div class="label">アレルギー内容（自由記載）</div>
      <textarea id="allergyDetail" rows="2" placeholder="例）花粉／金属（ニッケル）／化粧品（銘柄など）"></textarea>
    </div>

    <!-- ⑥ 過去にまつエクを受けたことはありますか？（必須） -->
    <div class="label"><span class="required">必須</span>⑥ 過去にまつエクを受けたことはありますか？</div>
    <div class="group" data-key="hadExtensions">
      <button type="button" data-value="はい" onclick="selectSingle('hadExtensions', this)">はい</button>
      <button type="button" data-value="いいえ" onclick="selectSingle('hadExtensions', this)">いいえ</button>
    </div>

    <!-- ⑦ 普段使用しているものはありますか？（必須） -->
    <div class="label"><span class="required">必須</span>⑦ 普段使用しているものはありますか？</div>
    <div class="group" data-key="eyeWear">
      <button type="button" data-value="メガネ" onclick="selectSingle('eyeWear', this)">メガネ</button>
      <button type="button" data-value="コンタクトレンズ" onclick="selectSingle('eyeWear', this)">コンタクトレンズ</button>
      <button type="button" data-value="なし" onclick="selectSingle('eyeWear', this)">なし</button>
    </div>

    <!-- ⑧ 希望スタイル（任意） -->
    <div class="label">⑧ 希望スタイル（任意）</div>
    <textarea id="style" rows="3" placeholder="例）つり目にしたい／たれ目にしたい／目を大きくしたい など"></textarea>

    <button class="submit-button" onclick="submitForm()" id="section-message">送信</button>
  </div>

  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
  <script>
    // あなたのLIFF IDに差し替え可能
    const LIFF_ID = '2005254357-zKma9BZk';

    // 単一選択の状態
    const state = { allergy:'', hadExtensions:'', eyeWear:'' };

    function selectSingle(key, el){
      const group = document.querySelector(`.group[data-key="${key}"]`);
      group.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
      el.classList.add('active');
      state[key] = el.dataset.value;

      // ⑤ アレルギー「ある」→詳細欄表示
      if(key === 'allergy'){
        const wrap = document.getElementById('allergyDetailWrap');
        if(state.allergy === 'ある'){ wrap.classList.remove('hidden'); }
        else{ wrap.classList.add('hidden'); document.getElementById('allergyDetail').value=''; }
      }
    }

    // LIFF初期化
    document.addEventListener('DOMContentLoaded', async ()=>{
      try{
        if(window.liff){ await liff.init({ liffId: LIFF_ID }); }
      }catch(e){ console.warn('LIFF初期化失敗:', e); }
    });

    function validate(){
      const name = document.getElementById('name').value.trim();
      const tel = document.getElementById('tel').value.trim();
      const address = document.getElementById('address').value.trim();

      if(!name){ alert('お名前を入力してください。'); return false; }
      if(!tel){ alert('お電話番号を入力してください。'); return false; }
      const telOk = /^0\d{9,10}$/.test(tel.replace(/-/g,''));
      if(!telOk){ alert('電話番号の形式をご確認ください（例：09012345678）'); return false; }
      if(!address){ alert('お住まいを入力してください。'); return false; }
      if(!state.allergy){ alert('アレルギーの有無を選択してください。'); return false; }
      if(state.allergy==='ある' && !document.getElementById('allergyDetail').value.trim()){
        alert('アレルギー内容をご記入ください。'); return false;
      }
      if(!state.hadExtensions){ alert('まつエク経験の有無を選択してください。'); return false; }
      if(!state.eyeWear){ alert('普段使用しているものを選択してください。'); return false; }
      return true;
    }

    function buildMessage(){
      const v = {
        name: document.getElementById('name').value.trim(),
        tel: document.getElementById('tel').value.trim(),
        birthday: document.getElementById('birthday').value.trim(),
        address: document.getElementById('address').value.trim(),
        allergy: state.allergy,
        allergyDetail: document.getElementById('allergyDetail').value.trim(),
        hadExtensions: state.hadExtensions,
        eyeWear: state.eyeWear,
        style: document.getElementById('style').value.trim(),
      };

      return [
        '≪カウンセリングシート≫',
        `① お名前\n・${v.name}`,
        `② お電話番号\n・${v.tel}`,
        v.birthday ? `③ 生年月日\n・${v.birthday}` : '',
        `④ お住まい\n・${v.address}`,
        `⑤ アレルギー\n・${v.allergy}` + (v.allergy==='ある' && v.allergyDetail ? `\n・内容：${v.allergyDetail}` : ''),
        `⑥ 過去にまつエクを受けたことはありますか？\n・${v.hadExtensions}`,
        `⑦ 普段使用しているもの\n・${v.eyeWear}`,
        v.style ? `⑧ 希望スタイル\n・${v.style}` : ''
      ].filter(Boolean).join('\n\n');
    }

    async function submitForm(){
      if(!validate()) return;
      const text = buildMessage();

      try{
        if(window.liff && liff.isInClient()){
          await liff.sendMessages([{ type:'text', text }]);
          alert('ご記入ありがとうございます。送信しました。');
          liff.closeWindow();
        }else{
          // LIFF外プレビュー
          alert('【プレビュー（LIFF外）】\n\n' + text);
        }
      }catch(err){
        console.error('メッセージの送信に失敗しました', err);
        alert('送信に失敗しました。通信環境をご確認ください。');
      }
    }
  </script>
</body>
</html>
